let uploadCount = 0;

function handleDragOver(event) {
    event.preventDefault();
}

function handleDrop(event) {
    event.preventDefault();
    const files = event.dataTransfer.files;
    handleFiles(files);
}

function handleFileInput(event) {
    const files = event.target.files;
    handleFiles(files);
}

function handleFiles(files) {
    // Display the file name
    const fileName = files[0].name;
    document.getElementById('file-name').innerText = `File Name: ${fileName}`;

    uploadCount++;

    // Check if it's the second upload
    if (uploadCount === 2) {
        // Reload the page after the second upload
        location.reload();
    }

    // Perform actions on the file
    checkForValue(files[0]);

    // Increase the upload count

}

function triggerFileInput() {
    document.getElementById('file-input').click();
}

function checkForValue(file) {
    const reader = new FileReader();

    reader.onload = function(event) {
        const fileContent = event.target.result;


        // Check if "123" exists in the file content
        function compareStringsIgnoreCaseAndSpace(str1, str2) {
            const formattedStr1 = str1.replace(/\s/g, '').toLowerCase();
            const formattedStr2 = str2.replace(/\s/g, '').toLowerCase();

            return formattedStr1 === formattedStr2;
        }




        const ENV00101 = "ENV00101";
        const isValidCertificate = fileContent.split('\n')[0].substring(0, 8);

        if (compareStringsIgnoreCaseAndSpace(isValidCertificate, ENV00101)){

            addElement("good");

        }else {
            addElement("bad");

        }


    };

    reader.readAsText(file);
}




function displayResult(contains123) {
    const messageResult = document.getElementById('messageRuslt');

    // Append new comment
    const newComment = contains123 ? 'File contains "123".' : 'File does not contain "123".';
    messageResult.innerHTML += `<p>${newComment}</p>`;
}




let myArray = [];

function addElement(value) {
    myArray.push(value);
    messageRuslt();
}


function messageRuslt() {
    // Get the div element
    const messageRuslt = document.getElementById('messageRuslt');

    // Clear the existing content
    messageRuslt.innerHTML = "";

    // Add each array element to the div
    myArray.forEach(function (element) {
        messageRuslt.innerHTML += `<p>${element}</p>`;
    });

}






function runTestAgain() {
    const fileInput = document.getElementById('file-input');
    const lastFile = fileInput.files[fileInput.files.length - 1];

    if (lastFile) {
        handleFiles([lastFile]);
    } else {
        const dropZoneFileName = document.getElementById('file-name').innerText.trim();

        if (dropZoneFileName) {
            // Extract file name from drop zone
            const fileName = dropZoneFileName.replace('File Name: ', '');

            // Create a dummy File object with an empty content
            const dummyFile = new File([''], fileName, { type: 'text/plain' });

            handleFiles([dummyFile]);
        } else {
            console.error('No file uploaded');
        }
    }
}